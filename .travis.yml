language: bash

git:
  depth: 1
  submodules: false

branches:
  only:
    - master
    - test

services:
  - docker

os:
  - linux
  - osx

env:
  - BASHVER=4.4
  - BASHVER=5.0

before_install:
  - |
    if [[ "$TRAVIS_OS_NAME" == 'osx' ]]; then
      ./tools/install-bash ${BASHVER}
      git submodule update --init --depth 1
    fi
  - |
    if [[ "$TRAVIS_OS_NAME" == 'linux' ]]; then
      docker pull lobash/test-bash:${BASHVER}
    fi

script:
  - |
    if [[ "$TRAVIS_OS_NAME" == 'linux' ]]; then
      time ./tools/test-in-docker
    else
      which bash
      bash --version
      time bash ./test
    fi

notifications:
  email:
    on_success: never
